<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-108906622-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-108906622-1', { 'anonymize_ip': true }); </script> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Power BI Scanner API List and document your Power BI tenant | LazySnail</title><meta name="generator" content="Jekyll v3.9.3" /><meta property="og:title" content="Power BI Scanner API List and document your Power BI tenant" /><meta property="og:locale" content="en_US" /><meta name="description" content="Power BI Fan page" /><meta property="og:description" content="Power BI Fan page" /><link rel="canonical" href="http://localhost:4000/power-bi/Power-BI-Scanner-API-List-and-document-your-Power-BI-tenant" /><meta property="og:url" content="http://localhost:4000/power-bi/Power-BI-Scanner-API-List-and-document-your-Power-BI-tenant" /><meta property="og:site_name" content="LazySnail" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-03-24T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Power BI Scanner API List and document your Power BI tenant" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-03-24T00:00:00+01:00","datePublished":"2023-03-24T00:00:00+01:00","description":"Power BI Fan page","headline":"Power BI Scanner API List and document your Power BI tenant","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/power-bi/Power-BI-Scanner-API-List-and-document-your-Power-BI-tenant"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/logo_lazysnail.png"}},"url":"http://localhost:4000/power-bi/Power-BI-Scanner-API-List-and-document-your-Power-BI-tenant"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/" class="site-title lh-tight"><div class="site-logo"></div></a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="/docs/Fabric" class="nav-list-link">Fabric</a><li class="nav-list-item active"><a href="/docs/Power-BI" class="nav-list-link">Power BI</a><li class="nav-list-item"><a href="/docs/SQL%20Server" class="nav-list-link">SQL Server</a><li class="nav-list-item"><a href="/docs/Obsidian" class="nav-list-link">Obsidian</a><li class="nav-list-item"><a href="/docs/Other" class="nav-list-link">Other</a><li class="nav-list-item"><a href="/docs/Links" class="nav-list-link">Links</a><li class="nav-list-item"><a href="/docs/About" class="nav-list-link">About Me</a></ul></nav></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search LazySnail" aria-label="Search LazySnail" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/docs/Power-BI">Power BI</a><li class="breadcrumb-nav-list-item"><span>Power BI Scanner API List and document your Power BI tenant</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 class="no_toc" id="documentation-of-your-power-bi-tenant-with-scanner-api"> <a href="#documentation-of-your-power-bi-tenant-with-scanner-api" class="anchor-heading" aria-labelledby="documentation-of-your-power-bi-tenant-with-scanner-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Documentation of your Power BI Tenant (With Scanner API)</h1><p><img src="/assets/2023/PBI_ScannerAPI/PBIScannerAPI.png" alt="Alt text" class="image50" /></p><h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents</h2><ol id="markdown-toc"><li><a href="#introduction" id="markdown-toc-introduction">Introduction</a><li><a href="#configuration" id="markdown-toc-configuration">Configuration</a><li><a href="#powershell-code" id="markdown-toc-powershell-code">Powershell code</a><ol><li><a href="#parameters" id="markdown-toc-parameters">Parameters</a><li><a href="#description" id="markdown-toc-description">Description</a><ol><li><a href="#more-info" id="markdown-toc-more-info">More info:</a></ol><li><a href="#getmodifiedworkspaces-list-of-workspaces" id="markdown-toc-getmodifiedworkspaces-list-of-workspaces">GetModifiedWorkspaces: List of workspaces</a><li><a href="#getscanresult-get-the-scan-result-download-our-json-file" id="markdown-toc-getscanresult-get-the-scan-result-download-our-json-file">GetScanResult: Get the scan result (Download our json file)</a><ol><li><a href="#getscanstatus-to-know-if-our-scan-is-done-or-still-pending" id="markdown-toc-getscanstatus-to-know-if-our-scan-is-done-or-still-pending">GetScanStatus: To know if our scan is done or still pending</a><li><a href="#getinfo-ask-powerbicom-to-perform-our-scan" id="markdown-toc-getinfo-ask-powerbicom-to-perform-our-scan">GetInfo: Ask Powerbi.com to perform our scan</a></ol><li><a href="#code" id="markdown-toc-code">Code</a></ol></ol><hr /><h2 id="introduction"> <a href="#introduction" class="anchor-heading" aria-labelledby="introduction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Introduction</h2><p>Power BI is a powerful data visualization tool that allows users to create insightful reports and dashboards from various data sources. However, to leverage the full potential of Power BI, it’s important to ensure the accuracy and security of your data. The Power BI Scanner API is designed to help you achieve this goal by scanning your Power BI resources for vulnerabilities and data leaks.</p><p>In this article, we will introduce you to the process of running the Power BI Scanner API in PowerShell. PowerShell is a flexible and powerful command-line tool that can be used to automate a wide range of administrative tasks. It also has a rich set of commandlets and modules that make it easy to work with Power BI.</p><p>Before getting started, you’ll need to ensure that you have the appropriate permissions and access keys to run the scanner API. Once you have these in place, you can follow the steps below to get started with PowerShell.</p><h2 id="configuration"> <a href="#configuration" class="anchor-heading" aria-labelledby="configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuration</h2><p>You need first to configure your Power BI tenant and activate these following options.</p><p>Go to your Admin portal</p><p><img src="/assets/2023/PBI_ScannerAPI/scanner_api_1.png" alt="Admin portal" /></p><p>and activate these options</p><p><img src="/assets/2023/PBI_ScannerAPI/scanner_api_2.png" alt="API enable config" /></p><h2 id="powershell-code"> <a href="#powershell-code" class="anchor-heading" aria-labelledby="powershell-code"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Powershell code</h2><h3 id="parameters"> <a href="#parameters" class="anchor-heading" aria-labelledby="parameters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Parameters</h3><p>Before running this code, you should change the path where you would like to save the json file <code class="language-plaintext highlighter-rouge">'C:\YOURPATH\result.json'</code></p><h3 id="description"> <a href="#description" class="anchor-heading" aria-labelledby="description"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Description</h3><p>This code use the 4 differents REST API method given by Microsoft.</p><h4 id="more-info"> <a href="#more-info" class="anchor-heading" aria-labelledby="more-info"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> More info:</h4><p><a href="https://learn.microsoft.com/en-us/power-bi/enterprise/service-admin-metadata-scanning">https://learn.microsoft.com/en-us/power-bi/enterprise/service-admin-metadata-scanning</a></p><h3 id="getmodifiedworkspaces-list-of-workspaces"> <a href="#getmodifiedworkspaces-list-of-workspaces" class="anchor-heading" aria-labelledby="getmodifiedworkspaces-list-of-workspaces"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> GetModifiedWorkspaces: List of workspaces</h3><p><a href="https://learn.microsoft.com/en-us/rest/api/power-bi/admin/workspace-info-get-modified-workspaces">https://learn.microsoft.com/en-us/rest/api/power-bi/admin/workspace-info-get-modified-workspaces</a></p><h3 id="getscanresult-get-the-scan-result-download-our-json-file"> <a href="#getscanresult-get-the-scan-result-download-our-json-file" class="anchor-heading" aria-labelledby="getscanresult-get-the-scan-result-download-our-json-file"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> GetScanResult: Get the scan result (Download our json file)</h3><p><a href="https://learn.microsoft.com/en-us/rest/api/power-bi/admin/workspace-info-get-scan-result">https://learn.microsoft.com/en-us/rest/api/power-bi/admin/workspace-info-get-scan-result</a></p><h4 id="getscanstatus-to-know-if-our-scan-is-done-or-still-pending"> <a href="#getscanstatus-to-know-if-our-scan-is-done-or-still-pending" class="anchor-heading" aria-labelledby="getscanstatus-to-know-if-our-scan-is-done-or-still-pending"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> GetScanStatus: To know if our scan is done or still pending</h4><p><a href="https://learn.microsoft.com/en-us/rest/api/power-bi/admin/workspace-info-get-scan-status">https://learn.microsoft.com/en-us/rest/api/power-bi/admin/workspace-info-get-scan-status</a></p><h4 id="getinfo-ask-powerbicom-to-perform-our-scan"> <a href="#getinfo-ask-powerbicom-to-perform-our-scan" class="anchor-heading" aria-labelledby="getinfo-ask-powerbicom-to-perform-our-scan"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> GetInfo: Ask Powerbi.com to perform our scan</h4><p><a href="https://learn.microsoft.com/en-us/rest/api/power-bi/admin/workspace-info-post-workspace-info">https://learn.microsoft.com/en-us/rest/api/power-bi/admin/workspace-info-post-workspace-info</a></p><h3 id="code"> <a href="#code" class="anchor-heading" aria-labelledby="code"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Code</h3><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Javascript code with syntax highlighting.</span>
<span class="kd">var</span> <span class="nx">fun</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">lang</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">dateformat</span><span class="p">.</span><span class="nx">i18n</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./lang/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">l</span><span class="p">)</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div><div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#                                                 _____ _____ </span><span class="w">
</span><span class="c">#                                           /\   |  __ \_   _|</span><span class="w">
</span><span class="c">#  ___  ___ __ _ _ __  _ __   ___ _ __     /  \  | |__) || |  </span><span class="w">
</span><span class="c"># / __|/ __/ _` | '_ \| '_ \ / _ \ '__|   / /\ \ |  ___/ | |  </span><span class="w">
</span><span class="c"># \__ \ (_| (_| | | | | | | |  __/ |     / ____ \| |    _| |_ </span><span class="w">
</span><span class="c"># |___/\___\__,_|_| |_|_| |_|\___|_|    /_/    \_\_|   |_____|</span><span class="w">
</span><span class="c">#</span><span class="w">
</span><span class="c">#---------------------------------</span><span class="w">
</span><span class="c"># Configuration</span><span class="w">

</span><span class="nv">$configExportFolderPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"C:\Users\ArnaudGastelblum\Desktop"</span><span class="w">
</span><span class="nv">$batchSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="w">


</span><span class="c"># End configuration</span><span class="w">
</span><span class="c">#---------------------------------</span><span class="w">

</span><span class="n">Login-PowerBIServiceAccount</span><span class="w">


</span><span class="c"># Get a list of all workspaces</span><span class="w">
</span><span class="n">write-host</span><span class="w"> </span><span class="s2">"Retrieve workspaces list"</span><span class="w">


</span><span class="nv">$url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://api.powerbi.com/v1.0/myorg/admin/workspaces/modified"</span><span class="w">
</span><span class="nv">$WorkspaceList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Invoke-PowerBIRestMethod</span><span class="w"> </span><span class="nt">-Url</span><span class="w"> </span><span class="nv">$url</span><span class="w"> </span><span class="nt">-Method</span><span class="w"> </span><span class="nx">Get</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ConvertFrom-Json</span><span class="w">

</span><span class="nv">$k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="kr">for</span><span class="p">(</span><span class="nv">$i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="nv">$WorkspaceList</span><span class="o">.</span><span class="nf">Length</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nv">$batchSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">

    </span><span class="c"># end index</span><span class="w">
    </span><span class="nv">$j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$batchSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$j</span><span class="w"> </span><span class="o">-ge</span><span class="w"> </span><span class="nv">$WorkspaceList</span><span class="o">.</span><span class="nf">Length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$WorkspaceList</span><span class="o">.</span><span class="nf">Length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">}</span><span class="w">

    </span><span class="nv">$myTmpObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$WorkspaceList</span><span class="p">[</span><span class="nv">$i</span><span class="o">..</span><span class="nv">$j</span><span class="p">]</span><span class="w">

    </span><span class="c"># show batches</span><span class="w">
    </span><span class="s2">"Batch </span><span class="nv">$k</span><span class="s2">"</span><span class="w">




    </span><span class="nv">$nbLoop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
    </span><span class="nv">$arg_WorkspaceList</span><span class="w"> </span><span class="o">=</span><span class="w">
    </span><span class="s1">'{
        "workspaces": [
    '</span><span class="w">

    </span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$record</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$myTmpObj</span><span class="p">)</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="kr">if</span><span class="p">(</span><span class="nv">$nbLoop</span><span class="w"> </span><span class="o">-gt</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> 
        </span><span class="p">{</span><span class="w"> 
          </span><span class="nv">$arg_WorkspaceList</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">',
          '</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="nv">$arg_WorkspaceList</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">'"'</span><span class="o">+</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="nv">$record</span><span class="o">.</span><span class="nf">id</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="s1">'"'</span><span class="w">
        </span><span class="nv">$nbLoop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$nbLoop</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">}</span><span class="w">

    </span><span class="nv">$arg_WorkspaceList</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">'
        ]
    }'</span><span class="w">

    
    </span><span class="n">write-host</span><span class="w"> </span><span class="s2">"Fetched workspaces: "</span><span class="o">+</span><span class="w"> </span><span class="nv">$arg_WorkspaceList</span><span class="w">


    </span><span class="c">#</span><span class="w">
    </span><span class="c"># Request a full description of our workspaces</span><span class="w">
    </span><span class="c">#</span><span class="w">
    </span><span class="n">write-host</span><span class="w"> </span><span class="s2">"Ask Power BI server to prepare a full list of infos"</span><span class="w">

    </span><span class="nv">$url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://api.powerbi.com/v1.0/myorg/admin/workspaces/getInfo?lineage=True&amp;datasourceDetails=True&amp;datasetSchema=True&amp;datasetExpressions=True&amp;getArtifactUsers=True"</span><span class="w">
    </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Invoke-PowerBIRestMethod</span><span class="w"> </span><span class="nt">-Url</span><span class="w"> </span><span class="nv">$url</span><span class="w"> </span><span class="nt">-Method</span><span class="w"> </span><span class="nx">Post</span><span class="w"> </span><span class="nt">-Body</span><span class="w"> </span><span class="nv">$arg_WorkspaceList</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ConvertFrom-Json</span><span class="w">


    </span><span class="nv">$scanId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$result</span><span class="o">.</span><span class="nf">id</span><span class="w">




    </span><span class="c"># Get the scan status</span><span class="w">
    </span><span class="c"># Check with the scanId generated above if the scan is ready or still in progress</span><span class="w">
    </span><span class="n">write-host</span><span class="w"> </span><span class="s2">"Test if export is available"</span><span class="w">
    </span><span class="nv">$url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://api.powerbi.com/v1.0/myorg/admin/workspaces/scanStatus/"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$scanId</span><span class="w">


    </span><span class="kr">Do</span><span class="w"> </span><span class="p">{</span><span class="w">
   
        </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Invoke-PowerBIRestMethod</span><span class="w"> </span><span class="nt">-Url</span><span class="w"> </span><span class="nv">$url</span><span class="w"> </span><span class="nt">-Method</span><span class="w"> </span><span class="nx">Get</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ConvertFrom-Json</span><span class="w">
        </span><span class="nv">$status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$result</span><span class="o">.</span><span class="nf">status</span><span class="w">
        </span><span class="n">write-host</span><span class="w"> </span><span class="nv">$status</span><span class="w">
        </span><span class="kr">if</span><span class="p">(</span><span class="nv">$status</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="s2">"Succeeded"</span><span class="p">){</span><span class="w">
            </span><span class="n">Start-Sleep</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nx">5</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="nv">$status</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="s2">"Succeeded"</span><span class="p">)</span><span class="w">






    </span><span class="c"># Download</span><span class="w">
    </span><span class="n">write-host</span><span class="w"> </span><span class="s2">"Retrieve Export"</span><span class="w">
    </span><span class="nv">$url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://api.powerbi.com/v1.0/myorg/admin/workspaces/scanResult/"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$scanId</span><span class="w">


    </span><span class="nv">$outputfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$configExportFolderPath</span><span class="w"> </span><span class="o">+</span><span class="s2">"\result_"</span><span class="o">+</span><span class="w"> </span><span class="nv">$k</span><span class="w"> </span><span class="o">+</span><span class="s2">".json"</span><span class="w">
    </span><span class="n">write-host</span><span class="w"> </span><span class="s2">"Write result in "</span><span class="o">+</span><span class="w"> </span><span class="nv">$outputfile</span><span class="w">
    </span><span class="n">Invoke-PowerBIRestMethod</span><span class="w"> </span><span class="nt">-Url</span><span class="w"> </span><span class="nv">$url</span><span class="w"> </span><span class="nt">-Method</span><span class="w"> </span><span class="nx">Get</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-file</span><span class="w"> </span><span class="nt">-FilePath</span><span class="w"> </span><span class="nv">$outputfile</span><span class="w">
    </span><span class="n">write-host</span><span class="w"> </span><span class="s2">"Export Ok"</span><span class="w">


    
    </span><span class="nv">$k</span><span class="o">++</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2015-2025 Arnaud Gastelblum.</p><div class="d-flex mt-2"></div></footer></div></div><div class="search-overlay"></div></div><script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script>
