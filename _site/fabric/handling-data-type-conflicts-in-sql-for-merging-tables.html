<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-108906622-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-108906622-1', { 'anonymize_ip': true }); </script> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Handling Data Type Conflicts in SQL for Merging Tables | LazySnail</title><meta name="generator" content="Jekyll v3.9.3" /><meta property="og:title" content="Handling Data Type Conflicts in SQL for Merging Tables" /><meta property="og:locale" content="en_US" /><meta name="description" content="Power BI Fan page" /><meta property="og:description" content="Power BI Fan page" /><link rel="canonical" href="http://localhost:4000/fabric/handling-data-type-conflicts-in-sql-for-merging-tables" /><meta property="og:url" content="http://localhost:4000/fabric/handling-data-type-conflicts-in-sql-for-merging-tables" /><meta property="og:site_name" content="LazySnail" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-09-20T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Handling Data Type Conflicts in SQL for Merging Tables" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-09-20T00:00:00+02:00","datePublished":"2024-09-20T00:00:00+02:00","description":"Power BI Fan page","headline":"Handling Data Type Conflicts in SQL for Merging Tables","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/fabric/handling-data-type-conflicts-in-sql-for-merging-tables"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/logo_lazysnail.png"}},"url":"http://localhost:4000/fabric/handling-data-type-conflicts-in-sql-for-merging-tables"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/" class="site-title lh-tight"><div class="site-logo"></div></a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a><li class="nav-list-item active"><a href="/docs/Fabric" class="nav-list-link">Fabric</a><li class="nav-list-item"><a href="/docs/Power-BI" class="nav-list-link">Power BI</a><li class="nav-list-item"><a href="/docs/SQL%20Server" class="nav-list-link">SQL Server</a><li class="nav-list-item"><a href="/docs/Obsidian" class="nav-list-link">Obsidian</a><li class="nav-list-item"><a href="/docs/Other" class="nav-list-link">Other</a><li class="nav-list-item"><a href="/docs/Links" class="nav-list-link">Links</a><li class="nav-list-item"><a href="/docs/About" class="nav-list-link">About Me</a></ul></nav></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search LazySnail" aria-label="Search LazySnail" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/docs/Fabric">Fabric</a><li class="breadcrumb-nav-list-item"><span>Handling Data Type Conflicts in SQL for Merging Tables</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 class="fs-9" id="handling-data-type-conflicts-in-sql-for-merging-tables"> <a href="#handling-data-type-conflicts-in-sql-for-merging-tables" class="anchor-heading" aria-labelledby="handling-data-type-conflicts-in-sql-for-merging-tables"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Handling Data Type Conflicts in SQL for Merging Tables</h1><p style="text-align: center;" class="image50"><img src="/assets/2024/handling-data-type-conflicts-in-sql-for-merging-tables/FeaturedImage.png" alt="image" /></p><h2 id="handling-data-type-conflicts-in-sql-queries"> <a href="#handling-data-type-conflicts-in-sql-queries" class="anchor-heading" aria-labelledby="handling-data-type-conflicts-in-sql-queries"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Handling Data Type Conflicts in SQL Queries</h2><p>In this post, I’m sharing a SQL query designed to help you merge two tables that might have similar columns but different data types. This is especially useful when you’re comparing tables from different schemas where column data types don’t always match. The query automates the conversion and comparison process, saving you the hassle of handling type conflicts manually.</p><h3 id="goal-of-the-query"> <a href="#goal-of-the-query" class="anchor-heading" aria-labelledby="goal-of-the-query"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Goal of the Query</h3><p>The goal is to merge two tables (<strong>Source1</strong> and <strong>Source2</strong>) by aligning their columns, even if the data types differ. For example, if one table has a <code class="language-plaintext highlighter-rouge">varchar</code> column and the other has a <code class="language-plaintext highlighter-rouge">bigint</code>, the query will convert them into a common type (like <code class="language-plaintext highlighter-rouge">varchar</code>). This lets you easily combine the data without errors.</p><h3 id="how-it-works"> <a href="#how-it-works" class="anchor-heading" aria-labelledby="how-it-works"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How It Works</h3><ol><li><p><strong>Setting Up</strong>: Replace the schema and table names in the query with your actual table names. The query works for any two tables you want to compare.</p><li><p><strong>Data Type Mapping</strong>: The query includes a list of data types that can be automatically converted. This ensures that different types like <code class="language-plaintext highlighter-rouge">varchar</code> and <code class="language-plaintext highlighter-rouge">bigint</code> are unified into a compatible data type.</p><li><p><strong>Table Comparison</strong>: The query extracts column details (like names and data types) from both tables. Then, it checks if the columns match or need to be converted.</p><li><p><strong>Merging the Data</strong>: Finally, the query merges the data from both tables into a single result set using <code class="language-plaintext highlighter-rouge">UNION ALL</code>, handling any differences in column data types.</p></ol><p>This method is useful for data migrations, ETL processes, or simply when you need to compare data across different systems.</p><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DECLARE</span> <span class="o">@</span><span class="n">Source1SchemaName</span>   <span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="o">=</span> <span class="s1">'YourFirstSchemaNameHere'</span><span class="p">;</span>
<span class="k">DECLARE</span> <span class="o">@</span><span class="n">Source1TableName</span>    <span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="o">=</span> <span class="s1">'YourFirstTableHere'</span><span class="p">;</span>
<span class="k">DECLARE</span> <span class="o">@</span><span class="n">Source2SchemaName</span>   <span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="o">=</span> <span class="s1">'YourSecondSchemaNameHere'</span><span class="p">;</span>
<span class="k">DECLARE</span> <span class="o">@</span><span class="n">Source2TableName</span>    <span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="o">=</span> <span class="s1">'YourSecondTableHere'</span><span class="p">;</span>

<span class="k">WITH</span> 
<span class="n">DataTypeSelection</span> <span class="k">AS</span>
<span class="p">(</span>
	<span class="k">SELECT</span> <span class="s1">'bigint'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'bigint'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'binary'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'varbinary'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'varbinary'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'varbinary'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'binary'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'varbinary'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'bit'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'int'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'int'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'int'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'bit'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'int'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'char'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'char'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'nchar'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'nvarchar'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'nvarchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'nvarchar'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'nchar'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'nvarchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'char'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'nvarchar'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'nvarchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'nvarchar'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'char'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'nvarchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'nchar'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'nvarchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'nchar'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'nvarchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'date'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'datetime'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'datetime2'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'datetime'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'date'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'datetime2'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'datetime2'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'datetime'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'datetime2'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'datetime'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'datetime2'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'datetime2'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'datetimeoffset'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'datetime'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'datetimeoffset'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'datetime'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'datetimeoffset'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'datetimeoffset'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'decimal'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'numeric'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'decimal'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'numeric'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'decimal'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'decimal'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'decimal'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'float'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'float'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'float'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'decimal'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'float'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'numeric'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'float'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'float'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'float'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'numeric'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'float'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'sysname'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'sysname'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'uniqueidentifier'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'uniqueidentifier'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'binary'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'varbinary'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'varbinary'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'varbinary'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'binary'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'varbinary'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'bigint'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'int'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'bigint'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'int'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'bigint'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'bigint'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>

	<span class="c1">--</span>
	<span class="c1">-- Perfect Match</span>
	<span class="c1">--</span>
	<span class="k">SELECT</span> <span class="s1">'bigint'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'bigint'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'bigint'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'binary'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'binary'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'binary'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'bit'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'bit'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'bit'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'char'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'char'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'char'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'date'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'date'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'date'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'datetime'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'datetime'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'datetime'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'datetime2'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'datetime2'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'datetime2'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'datetimeoffset'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'datetimeoffset'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'datetimeoffset'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'decimal'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'decimal'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'decimal'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'float'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'float'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'float'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'int'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'int'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'int'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'nchar'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'nchar'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'nchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'numeric'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'numeric'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'numeric'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'nvarchar'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'nvarchar'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'nvarchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'smallint'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'smallint'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'smallint'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'sql_variant'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'sql_variant'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'sql_variant'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'sysname'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'sysname'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'sysname'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'tinyint'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'tinyint'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'tinyint'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'uniqueidentifier'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'uniqueidentifier'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'uniqueidentifier'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'varbinary'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'varbinary'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'varbinary'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>
	<span class="k">UNION</span> <span class="k">ALL</span>
	<span class="k">SELECT</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">DataType1</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">DataType2</span><span class="p">,</span> <span class="s1">'varchar'</span> <span class="k">AS</span> <span class="n">TargetDataType</span>

<span class="p">)</span>


<span class="p">,</span><span class="n">Source1</span> <span class="k">AS</span>
<span class="p">(</span>
	<span class="k">SELECT</span> 
		<span class="k">c</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="n">ColumnName</span><span class="p">,</span>
		<span class="n">t</span><span class="p">.</span><span class="n">Name</span> <span class="k">AS</span> <span class="n">DataType</span><span class="p">,</span>
		<span class="k">c</span><span class="p">.</span><span class="n">max_length</span> <span class="k">AS</span> <span class="n">MaxLength</span><span class="p">,</span>
		<span class="k">c</span><span class="p">.</span><span class="nb">precision</span><span class="p">,</span>
		<span class="k">c</span><span class="p">.</span><span class="k">scale</span><span class="p">,</span>
		<span class="k">c</span><span class="p">.</span><span class="n">is_nullable</span><span class="p">,</span>
		<span class="k">ISNULL</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">is_primary_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">AS</span> <span class="n">PrimaryKey</span>
	<span class="k">FROM</span>    	    <span class="n">sys</span><span class="p">.</span><span class="n">columns</span>       <span class="k">c</span>
	<span class="k">INNER</span> <span class="k">JOIN</span>      <span class="n">sys</span><span class="p">.</span><span class="n">types</span>         <span class="n">t</span>  <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">user_type_id</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">user_type_id</span>
	<span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">sys</span><span class="p">.</span><span class="n">index_columns</span> <span class="n">ic</span> <span class="k">ON</span> <span class="n">ic</span><span class="p">.</span><span class="n">object_id</span>   <span class="o">=</span> <span class="k">c</span><span class="p">.</span><span class="n">object_id</span> <span class="k">AND</span> <span class="n">ic</span><span class="p">.</span><span class="n">column_id</span> <span class="o">=</span> <span class="k">c</span><span class="p">.</span><span class="n">column_id</span>
	<span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">sys</span><span class="p">.</span><span class="n">indexes</span>       <span class="n">i</span> <span class="k">ON</span> <span class="n">ic</span><span class="p">.</span><span class="n">object_id</span>    <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">object_id</span> <span class="k">AND</span> <span class="n">ic</span><span class="p">.</span><span class="n">index_id</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">index_id</span>
	<span class="k">WHERE</span> <span class="k">c</span><span class="p">.</span><span class="n">object_id</span> <span class="o">=</span> <span class="n">OBJECT_ID</span><span class="p">(</span><span class="o">@</span><span class="n">Source1SchemaName</span> <span class="o">+</span> <span class="s1">'.'</span> <span class="o">+</span> <span class="o">@</span><span class="n">Source1TableName</span><span class="p">)</span>
<span class="p">)</span>
<span class="p">,</span><span class="n">Source2</span> <span class="k">AS</span>
<span class="p">(</span>
	<span class="k">SELECT</span> 
		<span class="k">c</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="n">ColumnName</span><span class="p">,</span>
		<span class="n">t</span><span class="p">.</span><span class="n">Name</span> <span class="k">AS</span> <span class="n">DataType</span><span class="p">,</span>
		<span class="k">c</span><span class="p">.</span><span class="n">max_length</span> <span class="k">AS</span> <span class="n">MaxLength</span><span class="p">,</span>
		<span class="k">c</span><span class="p">.</span><span class="nb">precision</span><span class="p">,</span>
		<span class="k">c</span><span class="p">.</span><span class="k">scale</span><span class="p">,</span>
		<span class="k">c</span><span class="p">.</span><span class="n">is_nullable</span><span class="p">,</span>
		<span class="k">ISNULL</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">is_primary_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">AS</span> <span class="n">PrimaryKey</span>
	<span class="k">FROM</span>    	    <span class="n">sys</span><span class="p">.</span><span class="n">columns</span>       <span class="k">c</span>
	<span class="k">INNER</span> <span class="k">JOIN</span>      <span class="n">sys</span><span class="p">.</span><span class="n">types</span>         <span class="n">t</span>  <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">user_type_id</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">user_type_id</span>
	<span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">sys</span><span class="p">.</span><span class="n">index_columns</span> <span class="n">ic</span> <span class="k">ON</span> <span class="n">ic</span><span class="p">.</span><span class="n">object_id</span>   <span class="o">=</span> <span class="k">c</span><span class="p">.</span><span class="n">object_id</span> <span class="k">AND</span> <span class="n">ic</span><span class="p">.</span><span class="n">column_id</span> <span class="o">=</span> <span class="k">c</span><span class="p">.</span><span class="n">column_id</span>
	<span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">sys</span><span class="p">.</span><span class="n">indexes</span>       <span class="n">i</span> <span class="k">ON</span> <span class="n">ic</span><span class="p">.</span><span class="n">object_id</span>    <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">object_id</span> <span class="k">AND</span> <span class="n">ic</span><span class="p">.</span><span class="n">index_id</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">index_id</span>
	<span class="k">WHERE</span> <span class="k">c</span><span class="p">.</span><span class="n">object_id</span> <span class="o">=</span> <span class="n">OBJECT_ID</span><span class="p">(</span><span class="o">@</span><span class="n">Source2SchemaName</span> <span class="o">+</span> <span class="s1">'.'</span> <span class="o">+</span> <span class="o">@</span><span class="n">Source2TableName</span><span class="p">)</span>
<span class="p">)</span>





<span class="k">SELECT</span> <span class="s1">'WITH Source1 AS '</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">'('</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">'SELECT </span><span class="se">''</span><span class="s1">Source1</span><span class="se">''</span><span class="s1"> AS SourceSystem'</span>
<span class="k">UNION</span> <span class="k">ALL</span>

<span class="c1">--</span>
<span class="c1">-- Source1 section</span>
<span class="c1">--</span>
<span class="k">SELECT</span>
		<span class="s1">'	,'</span><span class="o">+</span>
		<span class="k">CASE</span> <span class="k">WHEN</span>  <span class="n">DataTypeSelection</span><span class="p">.</span><span class="n">TargetDataType</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">THEN</span>
			<span class="s1">'CONVERT('</span> <span class="o">+</span> <span class="n">DataTypeSelection</span><span class="p">.</span><span class="n">TargetDataType</span> <span class="o">+</span> 
						<span class="k">CASE</span> 
							<span class="k">WHEN</span> <span class="n">DataTypeSelection</span><span class="p">.</span><span class="n">TargetDataType</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'char'</span><span class="p">,</span> <span class="s1">'varchar'</span><span class="p">,</span> <span class="s1">'nchar'</span><span class="p">,</span> <span class="s1">'nvarchar'</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">'('</span> <span class="o">+</span> 
								<span class="k">CONVERT</span><span class="p">(</span>
									<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
									<span class="p">,</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">Source1</span><span class="p">.</span><span class="n">MaxLength</span> <span class="o">&gt;</span> <span class="n">Source2</span><span class="p">.</span><span class="n">MaxLength</span> 
										<span class="k">THEN</span> <span class="n">Source1</span><span class="p">.</span><span class="n">MaxLength</span>
										<span class="k">ELSE</span> <span class="n">Source2</span><span class="p">.</span><span class="n">MaxLength</span>
									<span class="k">END</span>
								<span class="p">)</span> <span class="o">+</span> <span class="s1">')'</span>
							<span class="k">WHEN</span> <span class="n">DataTypeSelection</span><span class="p">.</span><span class="n">TargetDataType</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'decimal'</span><span class="p">,</span> <span class="s1">'numeric'</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">'('</span> <span class="o">+</span> 
								<span class="k">CONVERT</span><span class="p">(</span>
									<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
									<span class="p">,</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">Source1</span><span class="p">.</span><span class="nb">precision</span> <span class="o">&gt;</span> <span class="n">Source2</span><span class="p">.</span><span class="nb">precision</span> 
										<span class="k">THEN</span> <span class="n">Source1</span><span class="p">.</span><span class="nb">precision</span>
										<span class="k">ELSE</span> <span class="n">Source2</span><span class="p">.</span><span class="nb">precision</span>
									<span class="k">END</span>
								<span class="p">)</span> <span class="o">+</span> <span class="s1">','</span> <span class="o">+</span> 
								<span class="k">CONVERT</span><span class="p">(</span>
									<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
									<span class="p">,</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">Source1</span><span class="p">.</span><span class="k">scale</span> <span class="o">&gt;</span> <span class="n">Source2</span><span class="p">.</span><span class="k">scale</span> 
										<span class="k">THEN</span> <span class="n">Source1</span><span class="p">.</span><span class="k">scale</span>
										<span class="k">ELSE</span> <span class="n">Source2</span><span class="p">.</span><span class="k">scale</span>
									<span class="k">END</span>
								<span class="p">)</span> <span class="o">+</span> <span class="s1">')'</span>
							<span class="k">ELSE</span> <span class="s1">''</span>
							<span class="k">END</span>
				<span class="o">+</span><span class="s1">', '</span><span class="o">+</span> <span class="n">Source1</span><span class="p">.</span><span class="n">ColumnName</span> <span class="o">+</span><span class="s1">') AS '</span><span class="o">+</span>  <span class="n">Source1</span><span class="p">.</span><span class="n">ColumnName</span> 
			<span class="k">ELSE</span> <span class="n">Source1</span><span class="p">.</span><span class="n">ColumnName</span> <span class="o">+</span><span class="s1">' AS '</span><span class="o">+</span> <span class="n">Source1</span><span class="p">.</span><span class="n">ColumnName</span> 
			<span class="k">END</span>
		<span class="c1">--,Source1.ColumnName</span>
		<span class="c1">--,Source1.DataType</span>
		<span class="c1">--,Source2.DataType</span>
		<span class="c1">--,DataTypeSelection.TargetDataType</span>
		<span class="c1">--,Source1.MaxLength</span>
		<span class="c1">--,Source2.MaxLength</span>

  <span class="k">FROM</span>      <span class="n">Source1</span>   <span class="n">Source1</span>
  <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">Source2</span>     <span class="n">Source2</span> <span class="k">ON</span> <span class="n">Source2</span><span class="p">.</span><span class="n">ColumnName</span> <span class="o">=</span> <span class="n">Source1</span><span class="p">.</span><span class="n">ColumnName</span>
  <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">DataTypeSelection</span>  <span class="k">ON</span>
	    <span class="n">DataTypeSelection</span><span class="p">.</span><span class="n">DataType1</span> <span class="o">=</span> <span class="n">Source1</span><span class="p">.</span><span class="n">DataType</span>
	<span class="k">AND</span> <span class="n">DataTypeSelection</span><span class="p">.</span><span class="n">DataType2</span> <span class="o">=</span> <span class="n">Source2</span><span class="p">.</span><span class="n">DataType</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">'----- Attributes only present in Source2 result'</span>
<span class="k">UNION</span> <span class="k">ALL</span>

<span class="k">SELECT</span> <span class="s1">'   ,'</span><span class="o">+</span>
		<span class="s1">'CONVERT('</span><span class="o">+</span> <span class="n">Source2</span><span class="p">.</span><span class="n">DataType</span> <span class="o">+</span>
			<span class="k">CASE</span> 
				<span class="k">WHEN</span> <span class="n">Source2</span><span class="p">.</span><span class="n">DataType</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'char'</span><span class="p">,</span> <span class="s1">'varchar'</span><span class="p">,</span> <span class="s1">'nchar'</span><span class="p">,</span> <span class="s1">'nvarchar'</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">'('</span> <span class="o">+</span> <span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">Source2</span><span class="p">.</span><span class="n">MaxLength</span><span class="p">)</span> <span class="o">+</span><span class="s1">')'</span>
				<span class="k">WHEN</span> <span class="n">Source2</span><span class="p">.</span><span class="n">DataType</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'decimal'</span><span class="p">,</span> <span class="s1">'numeric'</span><span class="p">)</span>                   <span class="k">THEN</span> <span class="s1">'('</span> <span class="o">+</span> <span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">Source2</span><span class="p">.</span><span class="nb">precision</span><span class="p">)</span> <span class="o">+</span><span class="s1">', '</span><span class="o">+</span> <span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">Source2</span><span class="p">.</span><span class="k">scale</span><span class="p">)</span> <span class="o">+</span><span class="s1">')'</span>
				<span class="k">ELSE</span> <span class="s1">''</span>
			<span class="k">END</span>
		 <span class="o">+</span><span class="s1">', NULL) AS '</span><span class="o">+</span> <span class="n">Source2</span><span class="p">.</span><span class="n">ColumnName</span> 
  <span class="k">FROM</span>      <span class="n">Source2</span> 
  <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">Source1</span> <span class="k">ON</span> <span class="n">Source1</span><span class="p">.</span><span class="n">ColumnName</span> <span class="o">=</span> <span class="n">Source2</span><span class="p">.</span><span class="n">ColumnName</span>
 <span class="k">WHERE</span> <span class="n">Source1</span><span class="p">.</span><span class="n">ColumnName</span> <span class="k">IS</span> <span class="k">NULL</span>


<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">'FROM '</span><span class="o">+</span> <span class="o">@</span><span class="n">Source1SchemaName</span> <span class="o">+</span> <span class="s1">'.'</span> <span class="o">+</span> <span class="o">@</span><span class="n">Source1TableName</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">')'</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">''</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">',Source2 AS'</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">'('</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">'SELECT </span><span class="se">''</span><span class="s1">Source2</span><span class="se">''</span><span class="s1"> AS SourceSystem'</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span>
		<span class="s1">'	,'</span><span class="o">+</span>
		<span class="k">CASE</span> <span class="k">WHEN</span>  <span class="n">DataTypeSelection</span><span class="p">.</span><span class="n">TargetDataType</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">THEN</span>
			<span class="s1">'CONVERT('</span> <span class="o">+</span> <span class="n">DataTypeSelection</span><span class="p">.</span><span class="n">TargetDataType</span> <span class="o">+</span> 
						<span class="k">CASE</span> 
							<span class="k">WHEN</span> <span class="n">DataTypeSelection</span><span class="p">.</span><span class="n">TargetDataType</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'char'</span><span class="p">,</span> <span class="s1">'varchar'</span><span class="p">,</span> <span class="s1">'nchar'</span><span class="p">,</span> <span class="s1">'nvarchar'</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">'('</span> <span class="o">+</span> 
								<span class="k">CONVERT</span><span class="p">(</span>
									<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
									<span class="p">,</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">Source1</span><span class="p">.</span><span class="n">MaxLength</span> <span class="o">&gt;</span> <span class="n">Source2</span><span class="p">.</span><span class="n">MaxLength</span> 
										<span class="k">THEN</span> <span class="n">Source1</span><span class="p">.</span><span class="n">MaxLength</span>
										<span class="k">ELSE</span> <span class="n">Source2</span><span class="p">.</span><span class="n">MaxLength</span>
									<span class="k">END</span>
								<span class="p">)</span> <span class="o">+</span> <span class="s1">')'</span>
							<span class="k">WHEN</span> <span class="n">DataTypeSelection</span><span class="p">.</span><span class="n">TargetDataType</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'decimal'</span><span class="p">,</span> <span class="s1">'numeric'</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">'('</span> <span class="o">+</span> 
								<span class="k">CONVERT</span><span class="p">(</span>
									<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
									<span class="p">,</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">Source1</span><span class="p">.</span><span class="nb">precision</span> <span class="o">&gt;</span> <span class="n">Source2</span><span class="p">.</span><span class="nb">precision</span> 
										<span class="k">THEN</span> <span class="n">Source1</span><span class="p">.</span><span class="nb">precision</span>
										<span class="k">ELSE</span> <span class="n">Source2</span><span class="p">.</span><span class="nb">precision</span>
									<span class="k">END</span>
								<span class="p">)</span> <span class="o">+</span> <span class="s1">','</span> <span class="o">+</span> 
								<span class="k">CONVERT</span><span class="p">(</span>
									<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
									<span class="p">,</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">Source1</span><span class="p">.</span><span class="k">scale</span> <span class="o">&gt;</span> <span class="n">Source2</span><span class="p">.</span><span class="k">scale</span> 
										<span class="k">THEN</span> <span class="n">Source1</span><span class="p">.</span><span class="k">scale</span>
										<span class="k">ELSE</span> <span class="n">Source2</span><span class="p">.</span><span class="k">scale</span>
									<span class="k">END</span>
								<span class="p">)</span> <span class="o">+</span> <span class="s1">')'</span>
							<span class="k">ELSE</span> <span class="s1">''</span>
							<span class="k">END</span>
				<span class="o">+</span><span class="s1">', '</span><span class="o">+</span> <span class="n">Source1</span><span class="p">.</span><span class="n">ColumnName</span> <span class="o">+</span><span class="s1">') AS '</span><span class="o">+</span> <span class="n">Source1</span><span class="p">.</span><span class="n">ColumnName</span> 
			<span class="k">ELSE</span> <span class="s1">'NULL AS '</span><span class="o">+</span> <span class="n">Source1</span><span class="p">.</span><span class="n">ColumnName</span> 
			<span class="k">END</span>
		<span class="c1">--,Source1.ColumnName</span>
		<span class="c1">--,Source1.DataType</span>
		<span class="c1">--,Source2.ColumnName</span>
		<span class="c1">--,Source2.DataType</span>
		<span class="c1">--,DataTypeSelection.TargetDataType</span>
		<span class="c1">--,Source1.MaxLength</span>
		<span class="c1">--,Source2.MaxLength</span>

  <span class="k">FROM</span>      <span class="n">Source1</span>   <span class="n">Source1</span>
  <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">Source2</span>     <span class="n">Source2</span> <span class="k">ON</span> <span class="n">Source2</span><span class="p">.</span><span class="n">ColumnName</span> <span class="o">=</span> <span class="n">Source1</span><span class="p">.</span><span class="n">ColumnName</span>
  <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">DataTypeSelection</span>  <span class="k">ON</span>
	    <span class="n">DataTypeSelection</span><span class="p">.</span><span class="n">DataType1</span> <span class="o">=</span> <span class="n">Source1</span><span class="p">.</span><span class="n">DataType</span>
	<span class="k">AND</span> <span class="n">DataTypeSelection</span><span class="p">.</span><span class="n">DataType2</span> <span class="o">=</span> <span class="n">Source2</span><span class="p">.</span><span class="n">DataType</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">'----- Attributes only present in Source2 result'</span>
<span class="k">UNION</span> <span class="k">ALL</span>

<span class="k">SELECT</span> <span class="s1">'   ,'</span><span class="o">+</span> <span class="n">Source2</span><span class="p">.</span><span class="n">ColumnName</span> 
  <span class="k">FROM</span>      <span class="n">Source2</span> 
  <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">Source1</span> <span class="k">ON</span> <span class="n">Source1</span><span class="p">.</span><span class="n">ColumnName</span> <span class="o">=</span> <span class="n">Source2</span><span class="p">.</span><span class="n">ColumnName</span>
 <span class="k">WHERE</span> <span class="n">Source1</span><span class="p">.</span><span class="n">ColumnName</span> <span class="k">IS</span> <span class="k">NULL</span>


<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">'FROM '</span> <span class="o">+</span> <span class="o">@</span><span class="n">Source2SchemaName</span> <span class="o">+</span> <span class="s1">'.'</span> <span class="o">+</span> <span class="o">@</span><span class="n">Source2TableName</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">')'</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">''</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">',MergeSourceSystem AS'</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">'('</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">'	SELECT * FROM Source1'</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">'	UNION ALL'</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">'	SELECT * FROM Source2'</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">')'</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">'SELECT '</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">'*'</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="s1">' FROM MergeSourceSystem'</span>

</code></pre></div></div><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2015-2025 Arnaud Gastelblum.</p><div class="d-flex mt-2"></div></footer></div></div><div class="search-overlay"></div></div><script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script>
